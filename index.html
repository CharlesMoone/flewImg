<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>css_display</title>
    <style>
        body {
            margin: 0;
            display: flex;
        }
        div {
            display: inherit;
            flex-wrap: wrap;
            align-content: flex-start;
            width: 24%;
            padding: 10px 0.5%;
        }
        div img {
            width: 100%;
            height: 100%;
            margin: 0 0 10px;
        }
    </style>
</head>
<body>
<div></div>
<div></div>
<div></div>
<div></div>
<script src="compatible.js"></script>
<script>
    /**
     * 图片类
     * @returns {ImageClass}
     * @constructor
     */
    var ImageClass = function () {
        if (this instanceof ImageClass) {
            this.constructor = ImageClass;
            this.div = document.getElementsByTagName('div');
            this.img = null;
            this.number = 0;
        } else {
            return new ImageClass();
        }
    };
    ImageClass.prototype = {
        init: function () {
            for (var i = 0; i < 20; i ++) {
                this.img = document.createElement('IMG');
                this.img.src = 'http://placehold.it/' + (100 + Math.floor(Math.random() * 100)) + 'x' + (Math.floor(Math.random() * 100) + 100);
                this.div[i%4].appendChild(this.img);
                var that = this;
                this.img.onload = function () {
                    if (++that.number != 20) {
                        return;
                    }
                    that.number = 0;
                    window.onscroll = function () {
                        if (compatible.getScrollTop() + compatible.getWindowHeight() == compatible.getScrollHeight()) {
                            console.log(1);
                            that.init();
                            window.onscroll = null;
                        }
                    };
                };
            }
        }
    };

    window.onload = function () {
        var image = new ImageClass();
        image.init();
    };
</script>
</body>
</html>